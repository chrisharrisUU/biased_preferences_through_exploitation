---
title: 'Biased preferences through exploitation: The effects of skewed outcome distributions
  on information sampling'
author: "Chris Harris"
date: "Last edited: `r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    output_dir: "Output"
---

```{r setup, include=FALSE}
# knitr::opts_chunk$set(echo = TRUE)
```

```{r init, include=FALSE}
# Dependencies
if (!require(needs)) {install.packages("needs"); library(needs)}
needs(dplyr, magrittr, ggplot2, car, here, tidyr, gridExtra, BayesFactor, papaja, purrr, gridExtra)
prioritize(dplyr)

# Functions
source(here("Auxiliary/functions.R"))
```

```{r blocks_exp1, include=FALSE}
### Data import
source(here("Auxiliary/Exp1_import.r"))

# Remove not completed cases
data1 %<>%
  filter(LASTPAGE == 14)

# Rename and create dataframe
column.rename <- function(.data) {
  # Prolific ID
  # Self-report
  participant.id <- .data %>%
    transmute(participant.id  = ifelse(grepl("@", DM01_01),
                                       substr(DM01_01, start = 1, stop = regexpr("@", DM01_01) - 1),
                                       DM01_01))
  # Read out from link
  session_id <- .data %>%
    transmute(id = as.character(substr(IV01_REF, start = 37, stop = 100)))
  # Counterbalancing
  # condition (rich vs impoverished)
  # primacy (A vs B)
  # winning color (yellow vs blue)
  # direction of question (yellow vs blue)
  # 1 rAyy  5 rByy   9 pAyy   13 pByy
  # 2 rAyb  6 rByb  10 pAyb   14 pByb
  # 3 rAby  7 rBby  11 pAby   15 pBby
  # 4 rAbb  8 rBbb  12 pAbb   16 pBbb
  
  # Condition
  # 1 -> rich, 75% wins
  # 2 -> impoverished, 75% losses
  condition <- .data %>%
    transmute(condition = ifelse(UR01 < 9, 1, 2)) %>%
    mutate(condition = factor(condition, levels = c(1,2), labels = c("rich", "impoverished")))
  # Primacy
  primacy <- .data %>%
    transmute(primacy = ifelse(UR01 %in% c(1:4, 9:12), -1, 1)) %>%
    mutate(primacy = factor(primacy, levels = c(-1,1), labels = c("A", "B")))
  # Winning
  winning <- .data %>%
    transmute(winning = ifelse(UR01 %in% c(1, 2, 5, 6, 9, 10, 13, 14), -1, 1)) %>%
    mutate(winning = factor(winning, levels = c(-1,1), labels = c("yellow", "blue")))
  # Direction
  direction <- .data %>%
    transmute(direction = ifelse(UR01 %in% c(1, 3, 5, 7, 9, 11, 13, 15), -1, 1)) %>%
    mutate(direction = factor(direction, levels = c(-1,1), labels = c("yellow", "blue")))
  # Full info
  levelnames <- c("rAyy", "rAyb", "rAby", "rAbb", "rByy", "rByb", "rBby", "rBbb",
                  "pAyy", "pAyb", "pAby", "pAbb", "pByy", "pByb", "pBby", "pBbb")
  # levelnames[1] <- "rAyy"
  # levelnames[7] <- "rBby"
  counterbalancing <- .data$UR01 %>%
    factor(levels = 1:16, labels = levelnames[1:16])
  
  
  # Points earned
  account <- as.integer(as.character(.data$IV02_02))
  
  # Choices in free selection phase
  freeselection <- .data %>%
    select(contains("TR02")) %>%
    select(everything(), -contains("a")) %>%
    mutate_all(funs(((function(x) {
      x <- gsub("sackA.svg", -1, x)
      x <- gsub("sackB.svg", 1, x)
      x %>%
        as.integer %>%
        return
    })(.))))
  # Assign useful column names
  colnames(freeselection) <- paste("week", 5:100, sep = "")
  # Create selection index
  freeselection <- freeselection %>%
    mutate(choiceindex_raw = rowSums(., na.rm = TRUE))
  # Two blocks
  freeselection$ci1_raw <- freeselection %>%
    select(paste0("week", 5:52)) %>%
    transmute(ci1_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  freeselection$ci2_raw <- freeselection %>%
    select(paste0("week", 53:100)) %>%
    transmute(ci2_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  # Four blocks
  freeselection$cia_raw <- freeselection %>%
    select(paste0("week", 5:28)) %>%
    transmute(cia_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  freeselection$cib_raw <- freeselection %>%
    select(paste0("week", 29:52)) %>%
    transmute(cia_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  freeselection$cic_raw <- freeselection %>%
    select(paste0("week", 53:76)) %>%
    transmute(cia_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  freeselection$cid_raw <- freeselection %>%
    select(paste0("week", 77:100)) %>%
    transmute(cia_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  
  # Second DVs
  # Preference
  postpref_raw <- .data %>%
    transmute(adjusted = DV02_01 - 1) %>%
    unlist
  # Conditionals
  postcond_raw <- .data %>%
    transmute(a_postcond = DV04_01 - 1,
              b_postcond = DV04_02 - 1)
  # Confidence
  postconf_raw <- .data %>%
    transmute(a_postconf = DV06_01 - 1,
              b_postconf = DV06_02 - 1)
  
  # Demographics
  dem <- .data %>%
    select(age = DM03,
           gender = DM04,
           psych = DM05,
           attcheck = DM02,
           edu = DM06)
  
  # Return dataframe
  data.frame(participant.id, session_id,
             counterbalancing, condition, primacy, winning, direction, account,
             # prepref_raw, precond_raw, preconf_raw,
             freeselection,
             postpref_raw, postcond_raw, postconf_raw,
             dem) %>%
    as_tibble() %>%
    return
}
df1b <- column.rename(data1)
rm(column.rename)

# Delete cases with too many missing choices
df1b$choiceNAs <- df1b %>%
  select(contains("week")) %>%
  apply(., 2, function(x) {
    y <- rep(0, length(x))
    y[which(is.na(x))] <- 1
    y
  }) %>%
  rowSums
excluded <- which(df1b$choiceNAs > 10)
df1b %<>%
  filter(choiceNAs < 10)

# Counterbalancing

# condition (rich vs impoverished)
# primacy (A vs B)
# winning color (yellow vs blue)
# direction of question (yellow vs blue)
# A |-------| B

do_counterbalance_1b <- function(df) {
  df %>%
    mutate(
      # This is the opposite of winning
      not_winning_color = ifelse(winning == "blue", "yellow", "blue")
    ) %>%
    mutate(
      # This is the color that was featured frequently
      freq_color = ifelse(condition == "rich", as.character(winning), not_winning_color)
    ) %>%
    mutate(
      # Add dummy variables
      quest_dir = ifelse(freq_color == direction, 1, 0)
    ) %>%
    mutate(
      # Add dummy variables
      quest_dir = factor(quest_dir)
    ) %>%
    mutate(
      # Everything as if asked from yellow's perspective
      postpref1 = ifelse(direction == "yellow", postpref_raw, 100 - postpref_raw),
      apostcond1 = ifelse(direction == "yellow", a_postcond, 100 - a_postcond),
      bpostcond1 = ifelse(direction == "yellow", b_postcond, 100 - b_postcond),
      apostconf1 = ifelse(direction == "yellow", a_postconf, 100 - a_postconf),
      bpostconf1 = ifelse(direction == "yellow", b_postconf, 100 - b_postconf)
    ) %>%
    mutate(
      # Everything asked from frequent
      postpref2 = ifelse(freq_color == "yellow", postpref1, 100 - postpref1),
      apostcond2 = ifelse(freq_color == "yellow", apostcond1, 100 - apostcond1),
      bpostcond2 = ifelse(freq_color == "yellow", bpostcond1, 100 - bpostcond1),
      apostconf2 = ifelse(freq_color == "yellow", apostconf1, 100 - apostconf1),
      bpostconf2 = ifelse(freq_color == "yellow", bpostconf1, 100 - bpostconf1)
    ) %>%
    mutate(
      # Collapse primacy
      postpref3 = ifelse(primacy == "B", postpref2, 100 - postpref2),
      postcond_1 = ifelse(primacy == "A", apostcond2 - bpostcond2, bpostcond2 - apostcond2),
      postconf_1 = ifelse(primacy == "A", apostconf2 - bpostconf2, bpostconf2 - apostconf2),
      choiceindex_freq = ifelse(primacy == "A", choiceindex_raw * (-1), choiceindex_raw),
      ci1_freq = ifelse(primacy == "A", ci1_raw * (-1), ci1_raw),
      ci2_freq = ifelse(primacy == "A", ci2_raw * (-1), ci2_raw),
      cia_freq = ifelse(primacy == "A", cia_raw * (-1), cia_raw),
      cib_freq = ifelse(primacy == "A", cib_raw * (-1), cib_raw),
      cic_freq = ifelse(primacy == "A", cic_raw * (-1), cic_raw),
      cid_freq = ifelse(primacy == "A", cid_raw * (-1), cid_raw)
    ) %>%
    mutate(
      # Shift from 0 - 100 to -50 to 50 and deltaps to -1, 1
      postpref_freq = postpref3 - 50,
      postcond_dp = postcond_1 / 100,
      postconf_dp = postconf_1 / 100
    ) %>%
    mutate(
      # Dominant coding for interaction effects: Flip negative condition
      postpref_dom = ifelse(condition == "rich", postpref_freq, postpref_freq * (-1)),
      choiceindex_dom = ifelse(condition == "rich", choiceindex_freq, choiceindex_freq * (-1)),
      postcond_dp_dom = ifelse(condition == "rich", postcond_dp, postcond_dp * (-1))) %>%
    mutate(
      # Sampling as percentage
      choiceindex_per = (choiceindex_freq + 96) / (96 * 2),
      ci1_per = (ci1_freq + 48) / (48 * 2),
      ci2_per = (ci2_freq + 48) / (48 * 2),
      cia_per = (cia_freq + 24) / (24 * 2),
      cib_per = (cib_freq + 24) / (24 * 2),
      cic_per = (cic_freq + 24) / (24 * 2),
      cid_per = (cid_freq + 24) / (24 * 2)
    )
}
df1b <- do_counterbalance_1b(df1b)
```

```{r blocks_exp2, include=FALSE}
### Data import
source(here("Auxiliary/Exp2_import.r"))

# Remove not completed cases
data2 %<>%
  filter(LASTPAGE == 16)

# Rename and create dataframe
column.rename <- function(.data) {
  # Prolific ID
  # Self-report
  participant.id <- .data %>%
    transmute(participant.id  = ifelse(grepl("@", DM01_01),
                                       substr(DM01_01, start = 1, stop = regexpr("@", DM01_01) - 1),
                                       DM01_01))
  # Read out from link
  session_id <- .data %>%
    transmute(id = as.character(substr(IV01_REF, start = 37, stop = 100)))
  # Counterbalancing
  # condition (rich vs impoverished)
  # primacy (A vs B)
  # winning color (yellow vs blue)
  # direction of question (yellow vs blue)
  # 1 rAyy  5 rByy   9 pAyy   13 pByy
  # 2 rAyb  6 rByb  10 pAyb   14 pByb
  # 3 rAby  7 rBby  11 pAby   15 pBby
  # 4 rAbb  8 rBbb  12 pAbb   16 pBbb
  
  # Condition
  # 1 -> rich, 75% wins
  # 2 -> impoverished, 75% losses
  condition <- .data %>%
    transmute(condition = ifelse(UR01 < 9, 1, 2)) %>%
    mutate(condition = factor(condition, levels = c(1,2), labels = c("rich", "impoverished")))
  # Primacy
  primacy <- .data %>%
    transmute(primacy = ifelse(UR01 %in% c(1:4, 9:12), -1, 1)) %>%
    mutate(primacy = factor(primacy, levels = c(-1,1), labels = c("A", "B")))
  # Winning
  winning <- .data %>%
    transmute(winning = ifelse(UR01 %in% c(1, 2, 5, 6, 9, 10, 13, 14), -1, 1)) %>%
    mutate(winning = factor(winning, levels = c(-1,1), labels = c("yellow", "blue")))
  # Direction
  direction <- .data %>%
    transmute(direction = ifelse(UR01 %in% c(1, 3, 5, 7, 9, 11, 13, 15), -1, 1)) %>%
    mutate(direction = factor(direction, levels = c(-1,1), labels = c("yellow", "blue")))
  # Full info
  levelnames <- attributes(data2$UR01) %>%
    unlist
  levelnames[1] <- "rAyy"
  levelnames[7] <- "rBby"
  counterbalancing <- data2$UR01 %>%
    factor(levels = 1:16, labels = levelnames[1:16])
  
  
  # Points earned
  account <- as.integer(as.character(.data$IV02_02))
  
  # Choices in free selection phase
  freeselection <- .data %>%
    select(contains("TR02")) %>%
    select(everything(), -contains("a")) %>%
    mutate_all(funs(((function(x) {
      x <- gsub("sackA.svg", -1, x)
      x <- gsub("sackB.svg", 1, x)
      x %>%
        as.integer %>%
        return
    })(.))))
  # Assign useful column names
  colnames(freeselection) <- paste("week", 17:100, sep = "")
  # Create selection index
  freeselection <- freeselection %>%
    mutate(choiceindex_raw = rowSums(., na.rm = TRUE))
  # Two blocks
  freeselection$ci1_raw <- freeselection %>%
    select(paste0("week", 17:58)) %>%
    transmute(ci1_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  freeselection$ci2_raw <- freeselection %>%
    select(paste0("week", 59:100)) %>%
    transmute(ci2_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  # Four blocks
  freeselection$cia_raw <- freeselection %>%
    select(paste0("week", 17:37)) %>%
    transmute(cia_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  freeselection$cib_raw <- freeselection %>%
    select(paste0("week", 38:58)) %>%
    transmute(cib_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  freeselection$cic_raw <- freeselection %>%
    select(paste0("week", 59:79)) %>%
    transmute(cic_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  freeselection$cid_raw <- freeselection %>%
    select(paste0("week", 80:100)) %>%
    transmute(cid_raw = rowSums(., na.rm = TRUE)) %>%
    unlist
  
  # Initial DVs
  # Preference
  prepref_raw <- .data %>%
    transmute(adjusted = DV01_01 - 1) %>%
    unlist
  # Conditionals
  precond_raw <- .data %>%
    transmute(a_precond = DV03_01 - 1,
              b_precond = DV03_02 - 1)
  # Confidence
  preconf_raw <- .data %>%
    transmute(a_preconf = DV05_01 - 1,
              b_preconf = DV05_02 - 1)
  
  # Second DVs
  # Preference
  postpref_raw <- .data %>%
    transmute(adjusted = DV02_01 - 1) %>%
    unlist
  # Conditionals
  postcond_raw <- .data %>%
    transmute(a_postcond = DV04_01 - 1,
              b_postcond = DV04_02 - 1)
  # Confidence
  postconf_raw <- .data %>%
    transmute(a_postconf = DV06_01 - 1,
              b_postconf = DV06_02 - 1)
  
  # Demographics
  dem <- .data %>%
    select(age = DM02,
           gender = DM03,
           psych = DM04,
           attcheck = DM05,
           edu = DM06)
  
  # Return dataframe
  data.frame(participant.id, session_id,
             counterbalancing, condition, primacy, winning, direction, account,
             prepref_raw, precond_raw, preconf_raw,
             freeselection,
             postpref_raw, postcond_raw, postconf_raw,
             dem) %>%
    as_tibble() %>%
    return
}
df2b <- column.rename(data2)
rm(column.rename)




do_counterbalance_2b <- function(df) {
  df %>%
    mutate(
      # This is the opposite of winning
      not_winning_color = ifelse(winning == "blue", "yellow", "blue")
    ) %>%
    mutate(
      # This is the color that was featured frequently
      freq_color = ifelse(condition == "rich", as.character(winning), not_winning_color)
    ) %>%
    mutate(
      # Add dummy variables
      quest_dir = ifelse(freq_color == direction, 1, 0)
    ) %>%
    mutate(
      # Everything as if asked from yellow's perspective
      prepref1 = ifelse(direction == "yellow", prepref_raw, 100 - prepref_raw),
      postpref1 = ifelse(direction == "yellow", postpref_raw, 100 - postpref_raw),
      aprecond1 = ifelse(direction == "yellow", a_precond, 100 - a_precond),
      bprecond1 = ifelse(direction == "yellow", b_precond, 100 - b_precond),
      apostcond1 = ifelse(direction == "yellow", a_postcond, 100 - a_postcond),
      bpostcond1 = ifelse(direction == "yellow", b_postcond, 100 - b_postcond),
      apreconf1 = ifelse(direction == "yellow", a_preconf, 100 - a_preconf),
      bpreconf1 = ifelse(direction == "yellow", b_preconf, 100 - b_preconf),
      apostconf1 = ifelse(direction == "yellow", a_postconf, 100 - a_postconf),
      bpostconf1 = ifelse(direction == "yellow", b_postconf, 100 - b_postconf)
    ) %>%
    mutate(
      # Everything asked from frequent
      prepref2 = ifelse(freq_color == "yellow", prepref1, 100 - prepref1),
      postpref2 = ifelse(freq_color == "yellow", postpref1, 100 - postpref1),
      aprecond2 = ifelse(freq_color == "yellow", aprecond1, 100 - aprecond1),
      bprecond2 = ifelse(freq_color == "yellow", bprecond1, 100 - bprecond1),
      apostcond2 = ifelse(freq_color == "yellow", apostcond1, 100 - apostcond1),
      bpostcond2 = ifelse(freq_color == "yellow", bpostcond1, 100 - bpostcond1),
      apreconf2 = ifelse(freq_color == "yellow", apreconf1, 100 - apreconf1),
      bpreconf2 = ifelse(freq_color == "yellow", bpreconf1, 100 - bpreconf1),
      apostconf2 = ifelse(freq_color == "yellow", apostconf1, 100 - apostconf1),
      bpostconf2 = ifelse(freq_color == "yellow", bpostconf1, 100 - bpostconf1)
    ) %>%
    mutate(
      # Collapse primacy
      prepref3 = ifelse(primacy == "B", prepref2, 100 - prepref2),
      postpref3 = ifelse(primacy == "B", postpref2, 100 - postpref2),
      precond_1 = ifelse(primacy == "A", aprecond2 - bprecond2, bprecond2 - aprecond2),
      postcond_1 = ifelse(primacy == "A", apostcond2 - bpostcond2, bpostcond2 - apostcond2),
      preconf_1 = ifelse(primacy == "A", apreconf2 - bpreconf2, bpreconf2 - apreconf2),
      postconf_1 = ifelse(primacy == "A", apostconf2 - bpostconf2, bpostconf2 - apostconf2),
      choiceindex_freq = ifelse(primacy == "A", choiceindex_raw * (-1), choiceindex_raw),
      ci1_freq = ifelse(primacy == "A", ci1_raw * (-1), ci1_raw),
      ci2_freq = ifelse(primacy == "A", ci2_raw * (-1), ci2_raw),
      cia_freq = ifelse(primacy == "A", cia_raw * (-1), cia_raw),
      cib_freq = ifelse(primacy == "A", cib_raw * (-1), cib_raw),
      cic_freq = ifelse(primacy == "A", cic_raw * (-1), cic_raw),
      cid_freq = ifelse(primacy == "A", cid_raw * (-1), cid_raw)
    ) %>%
    mutate(
      # Shift from 0 - 100 to -50 to 50 and deltaps to -1, 1
      prepref_freq = prepref3 - 50,
      postpref_freq = postpref3 - 50,
      precond_dp = precond_1 / 100,
      postcond_dp = postcond_1 / 100,
      preconf_dp = preconf_1 / 100,
      postconf_dp = postconf_1 / 100
    ) %>%
    mutate(
      # Dominant coding for interaction effects: Flip negative condition
      prepref_dom = ifelse(condition == "rich", prepref_freq, prepref_freq * (-1)),
      precond_dp_dom = ifelse(condition == "rich", precond_dp, precond_dp * (-1)),
      postpref_dom = ifelse(condition == "rich", postpref_freq, postpref_freq * (-1)),
      choiceindex_dom = ifelse(condition == "rich", choiceindex_freq, choiceindex_freq * (-1)),
      postcond_dp_dom = ifelse(condition == "rich", postcond_dp, postcond_dp * (-1))) %>%
    mutate(
      # Sampling as percentage
      choiceindex_per = (choiceindex_freq + 84) / (84 * 2),
      ci1_per = (ci1_freq + 42) / (42 * 2),
      ci2_per = (ci2_freq + 42) / (42 * 2),
      cia_per = (cia_freq + 21) / (21 * 2),
      cib_per = (cib_freq + 21) / (21 * 2),
      cic_per = (cic_freq + 21) / (21 * 2),
      cid_per = (cid_freq + 21) / (21 * 2)
    )
}
df2b <- do_counterbalance_2b(df2b)
```

#  {.tabset .tabset-fade}

For these analyses the `choiceindex` measure will be divided into blocks. Two blocks of 42 trials and four blocks of 21 trials. The variable names are `cia_per` and `ci2_per` as well as  `cia_per`, `cib_per`, `cic_per`, and `cid_per`.

## Experiment 1  {.tabset .tabset-fade}

Overall test of strength
```{r, results = "asis"}
df1b %>%
  mutate(choiceindex_per = ifelse(condition == "rich", choiceindex_per, 1 - choiceindex_per)) %>%
  as.data.frame() %>%
  ttestBF(formula = choiceindex_per ~ condition,
          nullInterval = c(0, Inf),
          data = .) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df1b %>%
  mutate(choiceindex_per = ifelse(condition == "rich", choiceindex_per, 1 - choiceindex_per)) %>%
  t.test(choiceindex_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

### Two blocks

#### Strength

##### First half:  
```{r, results = "asis"}
df1b %>%
  mutate(ci1_per = ifelse(condition == "rich", ci1_per, 1 - ci1_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = ci1_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df1b %>%
  mutate(ci1_per = ifelse(condition == "rich", ci1_per, 1 - ci1_per)) %>%
  t.test(ci1_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

<p>&nbsp;</p><p>&nbsp;</p>

##### Second half:
```{r, results = "asis"}
df1b %>%
  mutate(ci2_per = ifelse(condition == "rich", ci2_per, 1 - ci2_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = ci2_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df1b %>%
  mutate(ci2_per = ifelse(condition == "rich", ci2_per, 1 - ci2_per)) %>%
  t.test(ci2_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

### Four blocks

#### Strength

##### First block:  
```{r, results = "asis"}
df1b %>%
  mutate(cia_per = ifelse(condition == "rich", cia_per, 1 - cia_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = cia_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df1b %>%
  mutate(cia_per = ifelse(condition == "rich", cia_per, 1 - cia_per)) %>%
  t.test(cia_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

<p>&nbsp;</p><p>&nbsp;</p>

##### Second block:  
```{r, results = "asis"}
df1b %>%
  mutate(cib_per = ifelse(condition == "rich", cib_per, 1 - cib_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = cib_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df1b %>%
  mutate(cib_per = ifelse(condition == "rich", cib_per, 1 - cib_per)) %>%
  t.test(cib_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

<p>&nbsp;</p><p>&nbsp;</p>

##### Third block:  
```{r, results = "asis"}
df1b %>%
  mutate(cic_per = ifelse(condition == "rich", cic_per, 1 - cic_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = cic_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df1b %>%
  mutate(cic_per = ifelse(condition == "rich", cic_per, 1 - cic_per)) %>%
  t.test(cic_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

<p>&nbsp;</p><p>&nbsp;</p>

##### Fourth block:  
```{r, results = "asis"}
df1b %>%
  mutate(cid_per = ifelse(condition == "rich", cid_per, 1 - cid_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = cid_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df1b %>%
  mutate(cid_per = ifelse(condition == "rich", cid_per, 1 - cid_per)) %>%
  t.test(cid_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

<p>&nbsp;</p><p>&nbsp;</p>

#### Graph
```{r}
weeks <- colnames(df1b) %>%
  .[grep("week", .)] %>%
  substr(., 5, nchar(.)) %>%
  as.integer(.)
from <- min(weeks)
to <- max(weeks)

# Data prep
data <- prep(df1b)


graphBF <- c(df1b %>%
               mutate(cia_per = ifelse(condition == "rich", cia_per, 1 - cia_per)) %>%
               as.data.frame() %>%
               ttestBF(data = .,
                       formula = cia_per ~ condition,
                       nullInterval = c(0, Inf)) %>%
               (function(x) {sprintf("BF[+0] == %s", printnum(as.vector(x[1])))}),
             df1b %>%
               mutate(cib_per = ifelse(condition == "rich", cib_per, 1 - cib_per)) %>%
               as.data.frame() %>%
               ttestBF(data = .,
                       formula = cib_per ~ condition,
                       nullInterval = c(0, Inf)) %>%
               (function(x) {sprintf("BF[+0] == %s", printnum(as.vector(x[1])))}),
             df1b %>%
               mutate(cic_per = ifelse(condition == "rich", cic_per, 1 - cic_per)) %>%
               as.data.frame() %>%
               ttestBF(data = .,
                       formula = cic_per ~ condition,
                       nullInterval = c(0, Inf)) %>%
               (function(x) {sprintf("BF[+0] == %s", printnum(as.vector(x[1])))}),
             df1b %>%
               mutate(cid_per = ifelse(condition == "rich", cid_per, 1 - cid_per)) %>%
               as.data.frame() %>%
               ttestBF(data = .,
                       formula = cid_per ~ condition,
                       nullInterval = c(0, Inf)) %>%
               (function(x) {sprintf("BF[+0] == %s", printnum(as.vector(x[1])))}))


# Create graph
ggplot(data) +
  geom_rect(aes(xmin = 17, xmax = 37, ymin = .3, ymax = .75), fill = "gray96") +
  # geom_rect(aes(xmin = 38, xmax = 58, ymin = .3, ymax = .75), fill = "gray96") +
  geom_rect(aes(xmin = 59, xmax = 79, ymin = .3, ymax = .75), fill = "gray96") +
  # geom_rect(aes(xmin = 80, xmax = 100, ymin = .3, ymax = .75), fill = "gray96") +
  # geom_hline(yintercept = .5,
  #                alpha = .3) +
  geom_segment(aes(x = 5,
                   xend = 100,
                   y = .5,
                   yend = .5),
               color = "#999999",
               size = .1) +
  geom_point(aes(x = time,
                 y = sampling,
                 color = condition),
             size = .9) +
  geom_line(aes(x = time,
                y = sampling,
                color = condition),
            size = .2,
            alpha = .3) +
  geom_smooth(aes(x = time,
                  y = sampling,
                  color = condition),
              method = "loess",
              span = 1,
              size = 1) +
  annotate(geom = "text",
           x = 27,
           y = .73,
           label = graphBF[1],
           parse = TRUE) +
  annotate(geom = "text",
           x = 47,
           y = .73,
           label = graphBF[2],
           parse = TRUE) +
  annotate(geom = "text",
           x = 68,
           y = .73,
           label = graphBF[3],
           parse = TRUE) +
  annotate(geom = "text",
           x = 89,
           y = .73,
           label = graphBF[4],
           parse = TRUE) +
  # geom_vline(xintercept = 37.5, alpha = .3) +
  # geom_vline(xintercept = 58.5, alpha = .3) +
  # geom_vline(xintercept = 79.5, alpha = .3) +
  scale_color_brewer(palette = "Dark2") +
  theme_apa() +
  labs(y = "Percentage sampling frequent option",
       x = "Trial")
```


## Experiment 2  {.tabset .tabset-fade}

Overall test of strength
```{r, results = "asis"}
df2b %>%
  mutate(choiceindex_per = ifelse(condition == "rich", choiceindex_per, 1 - choiceindex_per)) %>%
  as.data.frame() %>%
  ttestBF(formula = choiceindex_per ~ condition,
          nullInterval = c(0, Inf),
          data = .) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df2b %>%
  mutate(choiceindex_per = ifelse(condition == "rich", choiceindex_per, 1 - choiceindex_per)) %>%
  t.test(choiceindex_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

### Two blocks

#### Strength

##### First half:  
```{r, results = "asis"}
df2b %>%
  mutate(ci1_per = ifelse(condition == "rich", ci1_per, 1 - ci1_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = ci1_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df2b %>%
  mutate(ci1_per = ifelse(condition == "rich", ci1_per, 1 - ci1_per)) %>%
  t.test(ci1_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

<p>&nbsp;</p><p>&nbsp;</p>

##### Second half:
```{r, results = "asis"}
df2b %>%
  mutate(ci2_per = ifelse(condition == "rich", ci2_per, 1 - ci2_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = ci2_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df2b %>%
  mutate(ci2_per = ifelse(condition == "rich", ci2_per, 1 - ci2_per)) %>%
  t.test(ci2_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

### Four blocks

#### Strength

##### First block:  
```{r, results = "asis"}
df2b %>%
  mutate(cia_per = ifelse(condition == "rich", cia_per, 1 - cia_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = cia_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df2b %>%
  mutate(cia_per = ifelse(condition == "rich", cia_per, 1 - cia_per)) %>%
  t.test(cia_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

<p>&nbsp;</p><p>&nbsp;</p>

##### Second block:  
```{r, results = "asis"}
df2b %>%
  mutate(cib_per = ifelse(condition == "rich", cib_per, 1 - cib_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = cib_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df2b %>%
  mutate(cib_per = ifelse(condition == "rich", cib_per, 1 - cib_per)) %>%
  t.test(cib_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

<p>&nbsp;</p><p>&nbsp;</p>

##### Third block:  
```{r, results = "asis"}
df2b %>%
  mutate(cic_per = ifelse(condition == "rich", cic_per, 1 - cic_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = cic_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df2b %>%
  mutate(cic_per = ifelse(condition == "rich", cic_per, 1 - cic_per)) %>%
  t.test(cic_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

<p>&nbsp;</p><p>&nbsp;</p>

##### Fourth block:  
```{r, results = "asis"}
df2b %>%
  mutate(cid_per = ifelse(condition == "rich", cid_per, 1 - cid_per)) %>%
  as.data.frame() %>%
  ttestBF(data = .,
          formula = cid_per ~ condition,
          nullInterval = c(0, Inf)) %>%
  printBFt(print = TRUE)
```

```{r, results = "asis"}
df2b %>%
  mutate(cid_per = ifelse(condition == "rich", cid_per, 1 - cid_per)) %>%
  t.test(cid_per ~ condition,
       alternative = "greater",
       data = .) %>%
  testoutputs(print = FALSE)
```

<p>&nbsp;</p><p>&nbsp;</p>

##### Graph
```{r}
weeks <- colnames(df2b) %>%
  .[grep("week", .)] %>%
  substr(., 5, nchar(.)) %>%
  as.integer(.)
from <- min(weeks)
to <- max(weeks)

# Data prep
data <- prep(df2b)


graphBF <- c(df2b %>%
               mutate(cia_per = ifelse(condition == "rich", cia_per, 1 - cia_per)) %>%
               as.data.frame() %>%
               ttestBF(data = .,
                       formula = cia_per ~ condition,
                       nullInterval = c(0, Inf)) %>%
               (function(x) {sprintf("BF[+0] == %s", printnum(as.vector(x[1])))}),
             df2b %>%
               mutate(cib_per = ifelse(condition == "rich", cib_per, 1 - cib_per)) %>%
               as.data.frame() %>%
               ttestBF(data = .,
                       formula = cib_per ~ condition,
                       nullInterval = c(0, Inf)) %>%
               (function(x) {sprintf("BF[+0] == %s", printnum(as.vector(x[1])))}),
             df2b %>%
               mutate(cic_per = ifelse(condition == "rich", cic_per, 1 - cic_per)) %>%
               as.data.frame() %>%
               ttestBF(data = .,
                       formula = cic_per ~ condition,
                       nullInterval = c(0, Inf)) %>%
               (function(x) {sprintf("BF[+0] == %s", printnum(as.vector(x[1])))}),
             df2b %>%
               mutate(cid_per = ifelse(condition == "rich", cid_per, 1 - cid_per)) %>%
               as.data.frame() %>%
               ttestBF(data = .,
                       formula = cid_per ~ condition,
                       nullInterval = c(0, Inf)) %>%
               (function(x) {sprintf("BF[+0] == %s", printnum(as.vector(x[1])))}))


# Create graph
ggplot(data) +
  geom_rect(aes(xmin = 17, xmax = 37, ymin = .3, ymax = .75), fill = "gray96") +
  # geom_rect(aes(xmin = 38, xmax = 58, ymin = .3, ymax = .75), fill = "gray96") +
  geom_rect(aes(xmin = 59, xmax = 79, ymin = .3, ymax = .75), fill = "gray96") +
  # geom_rect(aes(xmin = 80, xmax = 100, ymin = .3, ymax = .75), fill = "gray96") +
  # geom_hline(yintercept = .5,
  #                alpha = .3) +
  geom_segment(aes(x = 5,
                   xend = 100,
                   y = .5,
                   yend = .5),
               color = "#999999",
               size = .1) +
  geom_point(aes(x = time,
                 y = sampling,
                 color = condition),
             size = .9) +
  geom_line(aes(x = time,
                y = sampling,
                color = condition),
            size = .2,
            alpha = .3) +
  geom_smooth(aes(x = time,
                  y = sampling,
                  color = condition),
              method = "loess",
              span = 1,
              size = 1) +
  annotate(geom = "text",
           x = 27,
           y = .73,
           label = graphBF[1],
           parse = TRUE) +
  annotate(geom = "text",
           x = 47,
           y = .73,
           label = graphBF[2],
           parse = TRUE) +
  annotate(geom = "text",
           x = 68,
           y = .73,
           label = graphBF[3],
           parse = TRUE) +
  annotate(geom = "text",
           x = 89,
           y = .73,
           label = graphBF[4],
           parse = TRUE) +
  # geom_vline(xintercept = 37.5, alpha = .3) +
  # geom_vline(xintercept = 58.5, alpha = .3) +
  # geom_vline(xintercept = 79.5, alpha = .3) +
  scale_color_brewer(palette = "Dark2") +
  theme_apa() +
  labs(y = "Percentage sampling frequent option",
       x = "Trial")
```