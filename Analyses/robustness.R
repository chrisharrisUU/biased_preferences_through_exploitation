# Setup -------------------------------------------------------------------

btest <- function(c = "medium") {
  df3c %>%
    filter(condition == "rich") %>%
    as.data.frame() %$%
    ttestBF(choiceindex_per,
            mu = .5,
            nullInterval = c(0, Inf),
            rscale = c)
}

dir <- TRUE # BF10
# dir <- FALSE # BF01


# Variables -------------------------------------------------------------------------
runs <- 100
BF <- vector(mode = "numeric", length = runs)
r <- seq(0, 1.5, length.out = runs)
r[1] <- sqrt(2) / 2


# Run robustness tests ----------------------------------------------------
for (i in 1:runs) {
  output <- btest(r[i])
  if (dir) {
    BF[i] <- as.vector(output[1]) # BF10
  } else {
    
    BF[i] <- 1/as.vector(output[1]) # BF01
  }
}

df <- tibble(r, BF)


# Plot
ggplot(df) +
  geom_line(aes(x = r,
                 y = BF)) +
  geom_point(data = df[1,],
             aes(x = r,
                 y = BF),
             color = "red") +
  geom_hline(yintercept = 3,
             linetype = "dashed") +
  theme_apa() +
  labs(x = "Cauchy Prior Width (r)",
       y = "Bayes Factor (+0)") +
  annotate(geom = "text",
           x = 1,
           y = 6.5,
           label = "* Default Prior\n- - Stopping Rule")


# Run main test -----------------------------------------------------------
# Test
test <- btest() %>%
  printBFt()

# Robustness interval
rob <- df %>%
  filter(BF >= 3) %>%
  summarize(min = printnum(min(r)),
            max = printnum(max(r))) %>%
  as.vector()


# Report ------------------------------------------------------------------
paste0(test, ", robustness inverval: [", rob[1], ", ", rob[2], "]")
